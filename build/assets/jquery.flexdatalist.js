//# sourceMappingURL=jquery.flexdatalist.js.map
jQuery.fn.flexdatalist=function(m,p){var r=$(document),q=$(this),e=this;this._destroy=function(a){a||(a=q);a.each(function(){var a=$(this).data("flexdatalist");$(this).removeClass("flexdatalist-set").attr("type","text").val(a&&a.originalValue?a.originalValue:"").removeData("flexdatalist").next(".flexdatalist-alias, ul.flexdatalist-multiple").remove()})};this._reset=function(){this._destroy()};this._setValue=function(a){q.each(function(){var g=$(this),h=g.data("flexdatalist");h&&(h.originalValue=a,
""==a?(g.val(a,!0).trigger("change:flexdatalist",[a,a,h]).trigger("change"),h.multiple&&g.next("ul.flexdatalist-multiple").find("li.value").remove()):e._destroy())})};this._keyNum=function(a){return a.which||a.keyCode};r.data("flexdatalist")||$(document).mouseup(function(a){var e=$(".flexdatalist-results"),h=e.data("target");h&&h.is(":focus")||e.is(a.target)||0!==e.has(a.target).length||e.remove()}).keydown(function(a){var g=$(".flexdatalist-results"),h=g.find("li"),f=h.filter(".active"),m=f.index(),
p=h.length,b=e._keyNum(a);if(0!==p)if(13===b)a.preventDefault(),f.click();else if(40===b||38===b)a.preventDefault(),40===b?f=m<p&&0<f.nextAll(".item").first().length?f.removeClass("active").nextAll(".item").first().addClass("active"):h.removeClass("active").filter(".item:first").addClass("active"):38===b&&(f=0<m&&0<f.prevAll(".item").first().length?f.removeClass("active").prevAll(".item").first().addClass("active"):h.removeClass("active").filter(".item:last").addClass("active")),a=(0===f.prev().length?
f:f.prev()).position().top,g.animate({scrollTop:a+g.scrollTop()},100)}).data("flexdatalist",!0);this._isEmpty=function(a){if(e._isDefined(a)){if(null===a||!0!==a&&(0===this._length(a)||""===$.trim(a)))return!0}else return!0;return!1};this._isObject=function(a){return a&&"object"===typeof a};this._csvToArray=function(a,e){return 0===a.length?e:"string"===typeof a?a.split(","):a};this._length=function(a){return this._isObject(a)?Object.keys(a).length:"number"===typeof a.length?a.length:0};this._isDefined=
function(a,e){var h="undefined"!==typeof a;return h&&"undefined"!==typeof e?"undefined"!==typeof a[e]:h};this._options=function(a,g,h){var f=a.data("flexdatalist");if(e._isDefined(g)){if(e._isDefined(h))f[g]=h;else if(e._isObject(g))f=g;else return e._isDefined(f,g)?f[g]:null;f.searchIn=e._csvToArray(f.searchIn);f.relatives=f.relatives&&0<$(f.relatives).length?$(f.relatives):null;f.textProperty=null===f.textProperty?f.searchIn[0]:f.textProperty;f.visibleProperties=e._csvToArray(f.visibleProperties,
f.searchIn);a.data("flexdatalist",f)}return f};if("string"===typeof m)if("function"===typeof this["_"+m]){if(!this["_"+m]())return this}else if("value"===m)this._setValue(p);else return p?(e._options(q,m,p),this):e._options(q.data("flexdatalist"),m);return this.each(function(){var a=$(this),g,h,f={},p="",q=null;a.attr("name");a.hasClass("flexdatalist-set")&&e._destroy(a);e._options(a,$.extend({url:null,data:[],params:{},relatives:null,chainedRelatives:!1,cache:!0,minLength:2,groupBy:!1,selectionRequired:!1,
focusFirstResult:!1,textProperty:null,valueProperty:null,visibleProperties:[],searchIn:["label"],searchContain:!1,searchEqual:!1,searchDisabled:!1,normalizeString:null,multiple:a.attr("multiple"),maxShownResults:100,noResultsText:'No results found for "{keyword}"',toggleSelected:!1,_values:[]},a.data(),"object"===typeof m?m:{}));a._options=function(b,c){return e._options(a,b,c)};a._init=function(){var b=a._options();g=a.clone(!1).attr({list:null,name:null,id:a.attr("id")?a.attr("id")+"-flexdatalist":
null}).addClass("flexdatalist-alias").removeClass("flexdatalist");a._options("multiple")?(h=$("<ul>").addClass("flexdatalist-multiple").css({"border-color":a.css("border-left-color"),"border-width":a.css("border-left-width"),"border-style":a.css("border-left-style"),"border-radius":a.css("border-top-left-radius")}).insertAfter(a).click(function(){$(this).find("input").focus()}),$('<li class="input-container">').addClass("flexdatalist-multiple-value").append(g).appendTo(h)):g.insertAfter(a);g.attr("autofocus")&&
g.focus();g.on("input keydown",function(c){var d=a._keyword();188!==e._keyNum(c)&&13!==e._keyNum(c)||b.selectionRequired||!b.multiple?9===e._keyNum(c)?a._removeResults():0===d.length&&b.multiple&&8===e._keyNum(c)&&g.data("_remove",g.parents("li:eq(0)").prev()):(c.preventDefault(),a._value(d),a._removeResults())}).on("input keyup",function(c){a._changed()&&13!==e._keyNum(c)&&(c=a._keyword(),c.length>=b.minLength?a._search(function(b){a._showResults(b)}):a._removeResults(),b.multiple||(b.selectionRequired?
a._value(""):a._value(c)));if(c=g.data("_remove"))c.find(".fdl-remove").click(),g.data("_remove",null);p=a._keyword()}).focus(function(){var c=a._keyword();0===b.minLength?""===c&&a._tdata(function(b){a._showResults(b)}):c.length>=b.minLength&&!a._selected()&&a._search(function(b){a._showResults(b)})}).attr("autocomplete","off");window.onresize=function(b){a._position()};a.addClass("flexdatalist flexdatalist-set").attr("type","hidden")};a._changed=function(){return p!==a._keyword()};a._chained=function(){var b=
a._options();if(b.relatives&&b.chainedRelatives){var c=function(c){b.relatives.each(function(){var n=e._isEmpty($(this).val()),k=e._isEmpty(a.val());g.prop("disabled",n);c||!n&&k||(a._value(""),g.val(""),b.multiple&&h.find("li .fdl-remove").click());h&&(n&&h?h.addClass("disabled"):h.removeClass("disabled"))})};b.relatives.on("change",function(){c();f={}});c(!0)}};a._initValue=function(){var b=a.attr("value");e._isEmpty(b)||(a._options("originalValue",a.val()),a._parseValue(b,function(b){a.val("",
!0);g.val("");e._isEmpty(b)||a._values(b);p=a._keyword()}))};a._parseValue=function(b,c){var d=a._options();if(a._toJSON())try{c(JSON.parse(b))}catch(e){}else if(a._toCSV()||"string"===typeof d.valueProperty)if(b=b.split(","),"string"===typeof d.valueProperty){var n=d.searchIn;d.searchIn=d.valueProperty.split(",");d.searchEqual=!0;a._search(function(a){0<a.length&&c(a);d.searchIn=n;d.searchEqual=!1},b)}else c(b);else c(b)};a._tdata=function(b){a.trigger("before:flexdatalist.data");a._url(function(c){a._data(function(d){d=
d.concat(c);for(var e=a._options("_values"),k=0;k<d.length;k++){var l=d[k];e&&-1<e.indexOf(a._getText(l))&&delete d[k]}a.trigger("after:flexdatalist.data",[d]);b(d)})})};a._data=function(b){var c=a._options();"string"===typeof c.data?a._remote({url:c.data,success:function(d){d=a._getRemoteData(d);c.data=d;b(d)}}):b(c.data)};a._url=function(b){var c=a._options(),d=a._keyword(),n=a.val(),k=d;if(e._isEmpty(c.url))return b([]);clearTimeout(q);q=setTimeout(function(){c.cache&&2!==c.cache&&(k=d.substring(0,
0<c.minLength?c.minLength:1));var e=a._cache(k);if(e)b(e);else{var f={};$.each(c,function(a,b){0!=a.indexOf("_")&&(f[a]=b)});delete f.relatives;a._remote({url:c.url,data:$.extend(a._relativesData(),c.params,{keyword:d,contain:c.searchContain,selected:n,options:f}),success:function(c){c=a._getRemoteData(c);a._keyword().length>d.length?a._search(function(b){a._showResults(b)}):b(c);a._cache(k,c)}})}},200)};a._remote=function(b){a.hasClass("flexdatalist-loading")||(a.addClass("flexdatalist-loading"),
b=$.extend({type:"post",dataType:"json",complete:function(){a.removeClass("flexdatalist-loading")}},b),$.ajax(b))};a._getRemoteData=function(b){b=b.results?b.results:b;"string"===typeof b&&0===b.indexOf("[{")&&(b=JSON.parse(b));b.options&&e._options(a,b.options);return e._isObject(b)?b:[]};a._relativesData=function(){var b=a._options("relatives"),c={};b&&(c.relatives={},b.each(function(){var a=$(this),b=a.attr("name").split("][").join("-").split("]").join("-").split("[").join("-").replace(/^\|+|\-+$/g,
"");c.relatives[b]=a.val()}));return c};a._datalist=function(){var b=a._options(),c=a.attr("list");e._isEmpty(c)||(b.data=[],$("#"+c).find("option").each(function(){var a=$(this),c=a.val(),a=a.text();b.data.push({label:0<a.length?a:c,value:c})}));return a};a._cache=function(b,c){if(a._options("cache")){b=a._normalizeString(b);if(!e._isDefined(c))return e._isDefined(f,b)&&(c=f[b]),c;f[b]=c}return null};a._search=function(b,c){a._tdata(function(d){var n=[],k=a._options();if(k.searchDisabled)return b(d);
e._isDefined(c)||(c=a._keyword());"string"===typeof c&&(c=[c]);a.trigger("before:flexdatalist.search",[c,d]);for(var l=0;l<c.length;l++)for(var f=c[l],g=0;g<d.length;g++){var h=a._matches(d[g],f,k.values);h&&n.push(h)}a.trigger("after:flexdatalist.search",[c,d,n]);b(n)})};a._matches=function(b,c,d){d=!1;for(var n=$.extend({},b),k=a._options().searchIn,l=0;l<k.length;l++){var f=k[l];if(e._isDefined(b,f)&&b[f]){var g=b[f].toString();a._find(c,g)&&(n[f+"_highlight"]=a._highlight(c,g),d=!0)}}return d?
n:null};a._highlight=function(b,c){return c.replace(new RegExp(b,a._options("searchContain")?"ig":"i"),'<span class="highlight">$&</span>')};a._find=function(b,c){var d=a._options();c=a._normalizeString(c);b=a._normalizeString(b);return d.searchEqual?c==b:d.searchContain?0<=c.indexOf(b):0===c.indexOf(b)};a._showResults=function(b){a._removeResults(!0);var c=a._options();if(0===b.length)a._noResults(c.noResultsText);else{var d=a._getResultsContainer();c.groupBy?(b=a._groupData(b),Object.keys(b).forEach(function(e,
f){f=b[e];e=a._getHighlight(f[0],c.groupBy,e);$("<li>").addClass("group").append($("<span>").addClass("group-name").html(e)).append($("<span>").addClass("group-item-count").text(" "+f.length)).appendTo(d);a._items(f,d)})):a._items(b,d);var e=d.find("li:not(.group)");e.on("click",function(b){if(b=$(this).data("item"))a._selected(!0)._removeResults()._value(b),a.trigger("select:flexdatalist",[b,c])}).hover(function(){e.removeClass("active");$(this).addClass("active")},function(){$(this).removeClass("active")});
c.focusFirstResult&&e.filter(":first").addClass("active")}};a._noResults=function(b){if(!e._isEmpty(b)){var c=a._getResultsContainer(),d=a._keyword();b=b.split("{keyword}").join(d);$("<li>").addClass("item no-results").append(b).appendTo(c)}};a._groupData=function(b){for(var c=[],d=a._options("groupBy"),f=0;f<b.length;f++){var k=b[f];if(e._isDefined(k,d)){var g=k[d];e._isDefined(c,g)||(c[g]=[]);c[g].push(k)}}return c};a._items=function(b,c){var d=a._options("maxShownResults");a.trigger("show:flexdatalist.results",
[b]);for(var e=0;e<b.length&&!(0<d&&d===e);e++)a._item(b[e]).appendTo(c);a.trigger("shown:flexdatalist.results",[b])};a._item=function(b){for(var c=$("<li>").data("item",b).addClass("item"),d=a._options(),f=d.visibleProperties,g=0;g<f.length;g++){var l=f[g];if((!d.groupBy||d.groupBy!==l)&&e._isDefined(b,l)){if("thumb"===l)l=$("<img>").addClass("item item-"+l).attr("src",b[l]);else var h=a._getHighlight(b,l),l=$("<span>").addClass("item item-"+l).html(h+" ");l.appendTo(c)}}return c};a._getHighlight=
function(a,c,d){return e._isDefined(a,c+"_highlight")?a[c+"_highlight"]:e._isDefined(a,c)?a[c]:d};a._getResultsContainer=function(){var b=a;a._options("multiple")&&(b=h);var c=$("ul.flexdatalist-results");0===c.length&&(c=$("<ul>").addClass("flexdatalist-results").appendTo("body").css({"border-color":b.css("border-left-color"),"border-width":"1px","border-bottom-left-radius":b.css("border-bottom-left-radius"),"border-bottom-right-radius":b.css("border-bottom-right-radius")}).data("target",g),a._position());
return c};a._removeResults=function(b){var c="ul.flexdatalist-results";b&&(c="ul.flexdatalist-results li");$(c).remove();return a};a._selected=function(b){if(!e._isDefined(b))return a.hasClass("flexdatalist-selected");b?a.addClass("flexdatalist-selected"):a.removeClass("flexdatalist-selected");return a};a._values=function(b){$.isArray(b)&&!e._isEmpty(b)?$.each(b,function(b,d){a._value(d)}):a._value(b)};a._value=function(b){var c=a._options(),d=a._getText(b),e=a._getValue(b);0<d.length&&c._values.push(d);
if(c.multiple){if(""===b)return a;g.val("");b=$("<li>").addClass("value"+(c.toggleSelected?" toggle":"")).append('<span class="text">'+d+"</span>").append('<span class="fdl-remove">&times;</span>').insertBefore(h.find("li.input-container"));b.find("span.fdl-remove").click(function(){var b=$(this).parent(),d=b.index();if(!b.hasClass("disabled")&&(a._toJSON()||a._toCSV())){var e=a._inputValue();e.splice(d,1);c._values.splice(d,1);a._inputValue(e)}b.remove()});c.toggleSelected&&b.click(function(){var b=
$(this),e=a._inputValue(),f=b.index();if(b.hasClass("disabled")){var g=b.data("_value");e.splice(f,0,g);c._values.splice(f,0,a._getText(g));b.removeClass("disabled")}else g=e.splice(f,1),b.data("_value",g[0]),c._values.splice(f,1),b.addClass("disabled");a._inputValue(e,d)})}else d&&d!==g.val()&&g.val(d);a._inputValue(e,d);p=a._keyword();return a};a._inputValue=function(b,c){var d=a._toJSON(),f=a._toCSV();if(!e._isDefined(b)){if(b=a.val())d?b=JSON.parse(b):f&&(b=b.split(","));else if(d||f)b=[];return b}e._isObject(b)&&
(d&&!e._isEmpty(b)?b=JSON.stringify(b):f&&(b=b.join(",")));""===b&&a._options("_values",[]);a.val(b,!0);a.trigger("change:flexdatalist",[b,c,a._options()]).trigger("change");return b};a._getText=function(b){var c=b,d=a._options();e._isObject(b)&&(c=b[d.searchIn[0]],c=e._isDefined(b,d.textProperty)?b[d.textProperty]:a._replacePlaceholders(b,d.textProperty,c));return $("<div>").html(c).text()};a._getValue=function(b){var c=b,d=a._options();if(e._isObject(b))if(c=b[d.searchIn[0]],"*"===d.valueProperty)c=
b;else if(e._isDefined(b,d.valueProperty))c=b[d.valueProperty];else if(a._toJSON()){var c={},f=d.valueProperty,g=d.textProperty;if(g){var h=g;"string"===typeof g&&(h=a._parsePlaceholders(g));e._isObject(h)&&$.each(h,function(a,b){f.push(b)})}else e._isDefined(b,g)&&f.push(g);$.each(f,function(a,d){e._isDefined(b,d)&&(c[d]=b[d])})}d.multiple&&(a._toJSON()||a._toCSV())&&(d=a._inputValue(),!e._isEmpty(c)&&e._isObject(d)&&(d.push(c),c=d));return c};a._replacePlaceholders=function(b,c,d){if(e._isObject(b)&&
"string"===typeof c){var f=a._parsePlaceholders(c);if(!e._isEmpty(b)&&f)return $.each(f,function(a,d){e._isDefined(b,d)&&(c=c.replace(a,b[d]))}),c}return d};a._parsePlaceholders=function(a){if(a=a.match(/\{.+?\}/g)){var c={};a.map(function(a){c[a]=a.slice(1,-1)});return c}return!1};a._normalizeString=function(b){if("string"===typeof b){var c=a._options("normalizeString");"function"===typeof c&&(b=c(b));return b.toUpperCase()}return b};a._keyword=function(){return g.val().replace(/^\s+/,"")};a._toJSON=
function(){var b=a._options("valueProperty");return e._isObject(b)||"*"===b};a._toCSV=function(){return!a._toJSON()&&a._options("multiple")};a._position=function(){var b=g;a._options("multiple")&&(b=h);$("ul.flexdatalist-results").css({width:b.outerWidth()+"px",top:b.offset().top+b.outerHeight()+"px",left:b.offset().left+"px","z-index":b.css("z-index")+1})};a._init();a._datalist();a._initValue();a._chained()})};var _defaultValFunc=jQuery.fn.val;
jQuery.fn.val=function(m,p){!p&&$(this).hasClass("flexdatalist-set")&&"undefined"!==typeof m&&$(this).flexdatalist("value",m);return _defaultValFunc.apply(this,arguments)};$(function(){$("input.flexdatalist:not(.flexdatalist-set)").flexdatalist()});